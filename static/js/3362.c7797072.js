(self["define"]=self["define"]||[]).push([[3362],{52570:function(n,t){
/**
 * @author Markus Ekholm
 * @copyright 2012-2016 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2016, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
t.rgb_to_lab=o,t.rgba_to_lab=r,t.normalize_rgb=i;var e=Math.pow;Math.sqrt;function r(n,t){n=i(n);t="undefined"!==typeof t?i(t):{R:255,G:255,B:255};var e={R:t.R+(n.R-t.R)*n.A,G:t.G+(n.G-t.G)*n.A,B:t.B+(n.B-t.B)*n.A};return o(e)}function o(n){return c(a(n))}function a(n){n=i(n);var t=n.R/255,r=n.G/255,o=n.B/255;t>.04045?t=e((t+.055)/1.055,2.4):t/=12.92,r>.04045?r=e((r+.055)/1.055,2.4):r/=12.92,o>.04045?o=e((o+.055)/1.055,2.4):o/=12.92,t*=100,r*=100,o*=100;var a=.4124*t+.3576*r+.1805*o,c=.2126*t+.7152*r+.0722*o,s=.0193*t+.1192*r+.9505*o;return{X:a,Y:c,Z:s}}function c(n){var t=100,r=108.883,o=95.047,a=n.Y/t,c=n.Z/r,i=n.X/o;i=i>.008856?e(i,1/3):7.787*i+16/116,a=a>.008856?e(a,1/3):7.787*a+16/116,c=c>.008856?e(c,1/3):7.787*c+16/116;var s=116*a-16,l=500*(i-a),u=200*(a-c);return{L:s,a:l,b:u}}function i(n){var t={R:n.R||n.r||0,G:n.G||n.g||0,B:n.B||n.b||0};return"undefined"===typeof n.a&&"undefined"===typeof n.A||(t.A=n.A||n.a||0),t}},67235:function(n,t,e){e(77253),
/**
 * @author Markus Ekholm
 * @copyright 2012-2016 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2016, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
t.ciede2000=h;var r=Math.sqrt,o=Math.pow,a=Math.cos,c=Math.atan2,i=Math.sin,s=Math.abs,l=Math.exp,u=Math.PI;function h(n,t){var e=n.L,c=n.a,s=n.b,u=t.L,h=t.a,f=t.b,y=1,m=1,g=1,w=r(o(c,2)+o(s,2)),A=r(o(h,2)+o(f,2)),C=(w+A)/2,v=.5*(1-r(o(C,7)/(o(C,7)+o(25,7)))),b=(1+v)*c,E=(1+v)*h,S=r(o(b,2)+o(s,2)),M=r(o(E,2)+o(f,2)),B=R(s,b),G=R(f,E),O=u-e,Y=M-S,x=_(w,A,B,G),N=2*r(S*M)*i(d(x)/2),T=(e+u)/2,I=(S+M)/2,k=p(w,A,B,G),H=1-.17*a(d(k-30))+.24*a(d(2*k))+.32*a(d(3*k+6))-.2*a(d(4*k-63)),L=30*l(-o((k-275)/25,2)),P=r(o(I,7)/(o(I,7)+o(25,7))),V=1+.015*o(T-50,2)/r(20+o(T-50,2)),z=1+.045*I,j=1+.015*I*H,U=-2*P*i(d(2*L)),D=r(o(O/(V*y),2)+o(Y/(z*m),2)+o(N/(j*g),2)+U*(Y/(z*m))*(N/(j*g)));return D}function f(n){return n*(180/u)}function d(n){return n*(u/180)}function R(n,t){if(0===n&&0===t)return 0;var e=f(c(n,t));return e>=0?e:e+360}function _(n,t,e,r){if(n*t===0)return 0;if(s(r-e)<=180)return r-e;if(r-e>180)return r-e-360;if(r-e<-180)return r-e+360;throw new Error}function p(n,t,e,r){if(n*t===0)return e+r;if(s(e-r)<=180)return(e+r)/2;if(s(e-r)>180&&e+r<360)return(e+r+360)/2;if(s(e-r)>180&&e+r>=360)return(e+r-360)/2;throw new Error}},65268:function(n,t,e){"use strict";var r=e(67235),o=e(52570),a=e(12367),c=n.exports={};c.diff=r.ciede2000,c.rgb_to_lab=o.rgb_to_lab,c.rgba_to_lab=o.rgba_to_lab,c.map_palette=a.map_palette,c.palette_map_key=a.palette_map_key,c.map_palette_lab=a.map_palette_lab,c.lab_palette_map_key=a.lab_palette_map_key,c.match_palette_lab=a.match_palette_lab,c.closest=function(n,t,e){var r=c.palette_map_key(n);e="undefined"!==typeof e?e:{R:255,G:255,B:255};var o=c.map_palette([n],t,"closest",e);return o[r]},c.furthest=function(n,t,e){var r=c.palette_map_key(n);e="undefined"!==typeof e?e:{R:255,G:255,B:255};var o=c.map_palette([n],t,"furthest",e);return o[r]},c.closest_lab=function(n,t){return c.match_palette_lab(n,t,!1)},c.furthest_lab=function(n,t){return c.match_palette_lab(n,t,!0)}},12367:function(n,t,e){
/**
 * @author Markus Ekholm
 * @copyright 2012-2016 (c) Markus Ekholm <markus at botten dot org >
 * @license Copyright (c) 2012-2016, Markus Ekholm
 * All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *    * Redistributions of source code must retain the above copyright
 *      notice, this list of conditions and the following disclaimer.
 *    * Redistributions in binary form must reproduce the above copyright
 *      notice, this list of conditions and the following disclaimer in the
 *      documentation and/or other materials provided with the distribution.
 *    * Neither the name of the author nor the
 *      names of its contributors may be used to endorse or promote products
 *      derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MARKUS EKHOLM BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
t.map_palette=i,t.map_palette_lab=l,t.match_palette_lab=s,t.palette_map_key=a,t.lab_palette_map_key=c;var r=e(67235).ciede2000,o=e(52570);function a(n){n=o.normalize_rgb(n);var t="R"+n.R+"B"+n.B+"G"+n.G;return"A"in n&&(t=t+"A"+n.A),t}function c(n){return"L"+n.L+"a"+n.a+"b"+n.b}function i(n,t,e,r){var o={};r="undefined"!==typeof r?r:{R:255,G:255,B:255},e=e||"closest";for(var c=0;c<n.length;c+=1){for(var i=n[c],s=void 0,l=void 0,h=0;h<t.length;h+=1){var f=t[h],d=u(i,f,r);void 0==s||"closest"===e&&d<l?(s=f,l=d):"furthest"===e&&d>l&&(s=f,l=d)}o[a(i)]=s}return o}function s(n,t,e){for(var o,a,c=t[0],i=r(n,c),s=1,l=t.length;s<l;s+=1)o=t[s],a=r(n,o),(!e&&a<i||e&&a>i)&&(c=o,i=a);return c}function l(n,t,e){for(var r={},o="furthest"===e,a=0;a<n.length;a+=1){var i=n[a];r[c(i)]=s(i,t,o)}return r}function u(n,t,e){var a=o.rgb_to_lab,c=o.rgb_to_lab,i=function(n){return o.rgba_to_lab(n,e)};return"A"in n&&(a=i),"A"in t&&(c=i),n=a(n),t=c(t),r(n,t)}},92714:function(n,t,e){"use strict";e.d(t,{S1:function(){return l},jh:function(){return u}});e(670),e(80426),e(49743),e(36826),e(26263),e(77253);var r=e(3080),o="-\n \n%\n'\n+\n,\n.\n/\n0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n一\n七\n万\n不\n丽\n之\n乐\n九\n乡\n书\n云\n五\n亚\n人\n伊\n众\n优\n伤\n值\n假\n停\n傲\n儿\n元\n充\n兆\n光\n克\n兜\n八\n具\n冀\n冒\n冕\n军\n冠\n冰\n决\n凝\n凭\n凯\n凶\n击\n切\n利\n别\n刻\n力\n加\n动\n勇\n勋\n北\n医\n华\n卢\n印\n历\n原\n可\n叶\n吟\n命\n唤\n嗤\n器\n回\n团\n园\n国\n圣\n圭\n坚\n坠\n垂\n垢\n埃\n堇\n塑\n墨\n士\n壮\n壶\n备\n夏\n多\n头\n奇\n契\n奥\n女\n姿\n威\n娜\n子\n孑\n学\n守\n安\n宗\n官\n定\n室\n宫\n害\n宵\n家\n容\n宿\n寒\n将\n少\n尔\n尼\n尾\n岩\n峨\n峰\n嵯\n巉\n已\n巾\n帅\n师\n希\n带\n常\n帽\n幕\n平\n幸\n座\n异\n归\n形\n徒\n御\n徽\n心\n忆\n念\n怀\n怜\n思\n恋\n悟\n悯\n感\n慧\n成\n战\n托\n执\n护\n拉\n指\n挥\n摆\n摇\n摧\n攻\n放\n故\n效\n教\n斗\n方\n旋\n无\n早\n时\n明\n易\n星\n昭\n晨\n晴\n晷\n智\n暇\n暴\n望\n朝\n期\n末\n束\n条\n杯\n枫\n枭\n柏\n染\n柚\n桃\n梦\n樽\n武\n毅\n水\n沉\n沙\n治\n泉\n波\n泷\n泽\n洛\n流\n浮\n海\n涌\n渊\n渍\n渡\n温\n游\n溯\n漏\n潜\n火\n灭\n灵\n灼\n灾\n炎\n烟\n焦\n焱\n煎\n熬\n燃\n爵\n片\n物\n特\n狂\n猎\n玄\n率\n玉\n环\n珊\n珏\n珠\n班\n理\n琢\n琴\n瑚\n瑶\n璧\n瓢\n瓮\n甘\n生\n申\n电\n留\n疗\n的\n皿\n盅\n盏\n盘\n盟\n相\n真\n矢\n短\n石\n砂\n破\n磐\n礼\n祀\n祇\n祈\n祝\n神\n祭\n离\n秋\n章\n笃\n笑\n笔\n笠\n笼\n签\n箭\n精\n糖\n素\n红\n终\n经\n结\n绝\n绩\n绫\n绯\n绿\n缠\n罗\n羁\n群\n羽\n翎\n翠\n翼\n者\n而\n耳\n胡\n胸\n能\n脱\n船\n良\n艾\n芭\n花\n芳\n苦\n茶\n荒\n荣\n药\n莉\n莎\n莫\n莲\n菈\n菱\n菲\n落\n蔷\n薇\n藏\n虺\n血\n行\n表\n裂\n装\n裟\n角\n解\n誓\n计\n记\n许\n诺\n谢\n谣\n贝\n贤\n赌\n超\n越\n踏\n辔\n辛\n辰\n达\n运\n远\n迪\n迹\n追\n逐\n通\n逝\n遍\n遗\n郎\n酒\n酣\n醉\n醒\n里\n重\n野\n金\n鍪\n钟\n铁\n铜\n银\n镜\n镡\n闲\n防\n阳\n阿\n陀\n降\n院\n险\n雨\n雪\n雷\n霆\n霜\n露\n青\n面\n音\n颜\n风\n飘\n饰\n馆\n香\n马\n骑\n骨\n骰\n骸\n鬼\n魂\n魈\n魔\n鸟\n鹤\n鹰\n鹿\n黑",a=e(19390);const c=o.toString().trim().replace(/\r/g,"").split("\n");r.env.wasm.wasmPaths=a.ZP,r.env.wasm.numThreads=1;let i=null;function s(n){return Float32Array.from(n.map((n=>n/255)))}async function l(){return i=await r.InferenceSession.create(a.ZP["yas.ort"]),i}async function u(n){if(i||await l(),i){if(32!==n.rows||384!==n.cols)throw new Error("Wrong mat size");const t=new r.Tensor(s(n.data),[1,1,32,384]),e={[i.inputNames[0]]:t},o=await i.run(e),a=o[i.outputNames[0]].data,l=o[i.outputNames[0]].dims;let u=0,h=0;const f=[];let d="";for(let n=0;n<l[0];n++){const t=a.slice(n*l[2],(n+1)*l[2]),e=Math.max(...t),r=t.indexOf(e),o=c[r];r>0&&d!==o&&(h+=1+e,u+=1,f.push(o)),d=o}return{text:f.join(""),confidence:parseFloat((h/u*100).toFixed(2))}}throw new Error("init faild")}},71300:function(n,t,e){"use strict";e.d(t,{W6:function(){return i},rD:function(){return a},xc:function(){return c}});var r=e(40835);let o;async function a(n,t){const e=await(0,r.Yk)(),o=(0,r.SM)(e,n),a=(0,r.SM)(e,t);e.cvtColor(o,o,e.COLOR_RGBA2GRAY,0),e.cvtColor(a,a,e.COLOR_RGBA2GRAY,0),e.absdiff(o,a,a),e.threshold(a,a,130,255,e.THRESH_BINARY);const c=e.countNonZero(a);return a.delete(),o.delete(),c}async function c(n){const t=await(0,r.Yk)();try{if(!1===n){try{var e;null===(e=o)||void 0===e||e.delete()}catch(a){}return o=null,-1}if(!o)return o=(0,r.SM)(t,n),t.cvtColor(o,o,t.COLOR_RGBA2GRAY,0),-1;const c=(0,r.SM)(t,n);t.cvtColor(c,c,t.COLOR_RGBA2GRAY,0),t.absdiff(o,c,c),t.threshold(c,c,130,255,t.THRESH_BINARY);const i=t.countNonZero(c);return c.delete(),o=(0,r.SM)(t,n),t.cvtColor(o,o,t.COLOR_RGBA2GRAY,0),i}catch(a){throw(0,r.dW)(t,a)}}async function i(n){if(!1===n){try{var t;null===(t=o)||void 0===t||t.delete()}catch(i){}return o=null,-1}const e=await(0,r.Yk)();if(!o)return o=(0,r.SM)(e,n),e.cvtColor(o,o,e.COLOR_RGBA2GRAY,0),-1;const a=(0,r.SM)(e,n);e.cvtColor(a,a,e.COLOR_RGBA2GRAY,0),e.absdiff(o,a,a),e.adaptiveThreshold(a,a,255,e.ADAPTIVE_THRESH_GUASS_C,e.THRESH_BINARY,3,4);const c=e.countNonZero(a);return a.delete(),c}},69905:function(n,t,e){"use strict";e.r(t),e.d(t,{analyzeBag:function(){return c},analyzeBlocks:function(){return s},analyzeY:function(){return l},axisPoint:function(){return i},normalizeToYas:function(){return a}});e(77253),e(65946),e(16329);var r=e(87860),o=e(40835);async function a(n,t=!0,{pre:e,post:r}={}){const a=await(0,o.Yk)(),c=n.clone();let i;if(t){e?e(n):(a.threshold(n,n,120,255,a.THRESH_BINARY),a.cvtColor(n,n,a.COLOR_RGBA2GRAY,0));const t=new a.MatVector,r=new a.Mat;a.findContours(n,t,r,a.RETR_CCOMP,a.CHAIN_APPROX_SIMPLE);let o=9999,s=9999,u=0,h=0;for(let e=0;e<t.size();++e){const r=a.boundingRect(t.get(e));r.width>=n.cols&&r.height>=n.rows||(o=Math.min(o,r.x),s=Math.min(s,r.y),u=Math.max(u,r.y+r.height),h=Math.max(h,r.x+r.width))}i=c.roi(new a.Rect(o+1,s+1,h-o-2,u-s-2));try{n.delete()}catch(l){}try{c.delete()}catch(l){}}else i=c;a.resize(i,i,new a.Size(i.cols/i.rows*32,32),0,0,a.INTER_LINEAR),r?r(i):(a.threshold(i,i,155,255,a.THRESH_BINARY),a.cvtColor(i,i,a.COLOR_RGBA2GRAY,0),a.bitwise_not(i,i));const s=new a.Mat;return a.copyMakeBorder(i,s,0,0,0,384-i.cols,a.BORDER_CONSTANT,new a.Scalar(0,0,0,255)),i.delete(),s}async function c(n){const t=await(0,o.Yk)();let e;e=(0,r.Tj)(n)?(0,o.SM)(t,n):n;const a=new t.Mat;t.cvtColor(e,a,t.COLOR_RGBA2GRAY,0),t.adaptiveThreshold(a,a,255,t.ADAPTIVE_THRESH_GUASS_C,t.THRESH_BINARY,3,4);const c=t.Mat.ones(3,6,t.CV_8U);t.erode(a,a,c),c.delete();const i=new t.MatVector,s=new t.Mat;t.findContours(a,i,s,t.RETR_LIST,t.CHAIN_APPROX_SIMPLE);let l=null;const u=[];for(let r=0;r<i.size();++r){const n=t.boundingRect(i.get(r));if(n.width!==e.cols&&(!(n.width<16||n.height<16)&&!(n.height/n.width>10)))if(n.height>e.rows/2){if(l&&l.x>n.x)continue;l=n}else u.push(n)}if(!l)throw s.delete(),i.delete(),a.delete(),new Error("Panel not found");const h=l.x-10,f=e.cols-l.x-l.width-10,d=l.y-10,R=l.y+l.height+10,_=new t.Rect(f,d,h-f-20,R-d),p=u.filter((n=>n.x>h&&n.y<d)),y=p.sort(((n,t)=>t.x-n.x))[0],m=p.filter((n=>n.height!==y.height&&n.y<y.y+y.height))[0],g=u.filter((n=>n.x<f&&n.y>R)).sort(((n,t)=>n.x-t.x))[0],w=u.filter((n=>l&&n.x>=l.x-10&&n.y<=l.y&&n.y>m.y+m.height)).sort(((n,t)=>n.y-t.y))[0];return w&&(l.y=w.y-10,_.y=w.y-10),g&&(l.height=g.y-l.y-5,_.height=g.y-l.y-5),a.delete(),s.delete(),i.delete(),{panelRect:l,centerRect:_,countRect:m}}function i(n,t=20){let e=n.data[0];const r=[0];n.data.forEach(((n,t)=>{n!==e&&(e=n,r.push(t))})),r.push(n.data.length-1);let o=0,a=0,c=0,i=0;for(let u=1;u<r.length;u+=2)o+=r[u]-r[u-1],a++,r[u+1]&&(c+=r[u+1]-r[u],i++);o/=a,c/=i;const s=[],l=[];for(let u=1;u<r.length;u+=2)if(o>c){const n=r[u]-r[u-1];if(n<t)continue;s.push(Math.round((r[u]+r[u-1])/2)),l.push([r[u-1],r[u]])}else if(r[u+1]){const n=r[u+1]-r[u];if(n<t)continue;s.push(Math.round((r[u]+r[u+1])/2)),l.push([r[u],r[u+1]])}return{results:s,changePoints:r,blocks:l}}async function s(n){const t=await(0,o.Yk)();let e;e=(0,r.Tj)(n)?(0,o.SM)(t,n):n;const a=new t.Mat,c=new t.Mat;t.cvtColor(e,a,t.COLOR_RGBA2GRAY,0),t.Laplacian(a,a,t.CV_8U,1,1,0,t.BORDER_DEFAULT),t.reduce(a,c,0,t.CV_REDUCE_SUM,t.CV_32S),c.convertTo(c,t.CV_8U,.1),t.threshold(c,c,180,255,t.THRESH_BINARY_INV);const{results:s}=i(c);t.reduce(a,c,1,t.CV_REDUCE_SUM,t.CV_32S),c.convertTo(c,t.CV_8U,.1),t.threshold(c,c,180,255,t.THRESH_BINARY_INV);const{results:l}=i(c);return a.delete(),c.delete(),e.delete(),{x:s,y:l}}async function l(n){const t=await(0,o.Yk)();let e;e=(0,r.Tj)(n)?(0,o.SM)(t,n):n;const a=new t.Mat;t.cvtColor(e,a,t.COLOR_RGBA2GRAY,0),t.Canny(a,a,120,80,3,!1),t.reduce(a,a,1,t.CV_REDUCE_SUM,t.CV_32S),a.convertTo(a,t.CV_8U),t.threshold(a,a,160,255,t.THRESH_BINARY_INV);const{results:c,changePoints:s,blocks:l}=i(a),u=s.map((n=>a.data[n]));return a.delete(),e.delete(),{y:c,changeData:u,changePoints:s,blocks:l}}},56482:function(n,t,e){"use strict";e.d(t,{Gu:function(){return r},Z8:function(){return a},y9:function(){return c},yN:function(){return o}});let r=[],o=[],a=[];function c({map:n,params:t,characters:e,amos:c}){o=[],Object.keys(t).forEach((n=>{o.push({obj:n,str:t[n]})})),r=[],n.forEach((n=>{for(const t of n.contains)r.push({str:c[n.name],obj:{id:t.setId,type:t.type}})})),a=[],e.forEach((n=>{a.push({obj:n.key,str:c[n.name]})})),console.log("created artifact map with length=",r.length,o.length,a.length)}},9596:function(n,t,e){"use strict";e.r(t),e.d(t,{detectStars:function(){return v},init:function(){return f},onScreenShot:function(){return _},rawRecognizeArtifact:function(){return y},recognizeArtifact:function(){return p},setCachedBag:function(){return R},splitBottom:function(){return g},splitTop:function(){return w},splitUser:function(){return m}});var r;e(25766),e(65946),e(77253),e(43928);(function(n){n["DRESS"]="DRESS",n["BRACER"]="BRACER",n["SHOES"]="SHOES",n["RING"]="RING",n["NECKLACE"]="NECKLACE"})(r||(r={}));var o,a=e(40835),c=e(92714),i=e(69905),s=e(65268);(function(n){n["static"]="static",n["percent"]="percent"})(o||(o={})),function(n){n[n["hp"]=0]="hp",n[n["atk"]=1]="atk",n[n["def"]=2]="def",n[n["element"]=3]="element",n[n["recharge"]=4]="recharge",n[n["heal"]=5]="heal",n[n["crit"]=6]="crit",n[n["crit_dmg"]=7]="crit_dmg",n[n["physical_dmg"]=8]="physical_dmg",n[n["anemo_dmg"]=9]="anemo_dmg",n[n["geo_dmg"]=10]="geo_dmg",n[n["electro_dmg"]=11]="electro_dmg",n[n["hydro_dmg"]=12]="hydro_dmg",n[n["pyro_dmg"]=13]="pyro_dmg",n[n["cryo_dmg"]=14]="cryo_dmg",n[n["dendro_dmg"]=15]="dendro_dmg"}(o||(o={}));o.hp,o.atk,o.def,o.element,o.element;var l=e(56482),u=e(10160),h=e(87860);async function f(){await Promise.all([(0,a.Yk)(),(0,c.S1)()])}let d={};async function R(n){d=n}async function _(n){const t=await(0,a.Yk)();let e;e=(0,h.Tj)(n)?(0,a.SM)(t,n):n;let r=e;e.cols>e.rows&&(d.panelRect||(d=await(0,i.analyzeBag)(e)),r=e.roi(d.panelRect));const o=(0,a.gq)(t,r,!0);let c={success:!1,raw:[],image:o};try{c={...await p(r),image:o}}catch(s){console.error("number"===typeof s?(0,a.dW)(t,s):s)}try{r.delete()}catch(s){}try{e.delete()}catch(s){}return c}async function p(n){var t;const e=await y(n),a={id:Date.now().toString(16),hash:"",set:-1,slot:r.BRACER,level:0,stars:0,mainstat:{key:"",type:o["static"]},substat:[],locked:!1,character:null},c=["name","main","sub","mainval","level","stars","lock"],i={};let s=!0;for(const r of e){let n;switch(r.type){case"lock":a.locked="1"===r.text;break;case"stars":a.stars=parseInt(r.text,10);break;case"level":if(a.level=parseInt(r.text,10),isNaN(a.level)){s=!1;break}break;case"name":n=(0,u.NE)("str",r.text,l.Gu,r.text.length/3),n&&(a.set=n.obj.id,a.slot=n.obj.type);break;case"main":n=(0,u.NE)("str",r.text,l.yN,r.text.length/3),n&&(a.mainstat.key=n.obj);break;case"mainval":a.mainstat.type=r.text.includes("%")?o.percent:o["static"];break;case"sub":{const[t,e]=r.text.split("+");if(!e){s=!1;break}n=(0,u.NE)("str",t,l.yN,t.length),n&&a.substat.push({key:n.obj,type:e.includes("%")?o.percent:o["static"],value:Number(e.replace(/[^\d.]/g,""))});break}case"user":n=(0,u.NE)("str",(null===(t=r.text.replace("已装备","").replace("Equipped","").trim().match(/[a-zA-Z\u4e00-\u9fa5]/g))||void 0===t?void 0:t.join(""))||"",l.Z8,r.text.length),n&&(a.character=n.obj);break}i[r.type]=!0}return c.forEach((n=>{i[n]||(s=!1)})),{artifact:a,raw:e,success:s}}async function y(n){const t=await(0,a.Yk)(),e=(0,h.Tj)(n)?(0,a.SM)(t,n):n,{splitLine:r,rects:o}=await g(e),i=await w(e,r),s=[...i,...o],l=["name","main","sub","mainval","user","level"],u=[];for(const h of s)if(l.includes(h.type)&&h.roi){const n=await(0,c.jh)((0,a.gq)(t,h.roi));h.roi.delete(),u.push({type:h.type,rect:h.rect,...n})}else if("lock"===h.type&&h.roi){const n=h.roi;t.cvtColor(n,n,t.COLOR_RGBA2GRAY,0),t.threshold(n,n,110,255,t.THRESH_BINARY_INV);const e=t.countNonZero(n)>10;n.delete(),u.push({type:h.type,rect:h.rect,text:e?"1":"0",confidence:100})}else h.roi&&h.roi.delete();const f=s.find((n=>"name"===n.type));if(f){const n={x:2*f.rect.x+f.rect.width,y:f.mid},t=v([...e.ucharPtr(n.y,n.x)]);u.push({type:"stars",text:t.toString(),confidence:100,rect:{x:n.x,y:n.y,width:1,height:1}})}return(0,h.Tj)(n)&&e.delete(),u}async function m(n,{src:t,dst:e,hierarchy:r,M7:o},c){const s=await(0,a.Yk)();if(t.rows-n.rect.y-n.rect.height<n.rect.height){n.type="user",s.erode(e,e,o);const a=e.roi(n.rect);s.findContours(a,c,r,s.RETR_CCOMP,s.CHAIN_APPROX_SIMPLE);let u=9999,h=9999,f=0,d=0;for(let n=0;n<c.size();++n){const t=s.boundingRect(c.get(n));t.width>=a.cols-1||(t.height>=2*a.rows/3||t.height<=5||t.width<=5||(u=Math.min(u,t.x),h=Math.min(h,t.y),f=Math.max(f,t.y+t.height),d=Math.max(d,t.x+t.width)))}n.rect=new s.Rect(n.rect.x+u+3,n.rect.y+h+2,d-u-6,f-h-4);try{n.roi=await(0,i.normalizeToYas)(t.roi(n.rect),!1)}catch(l){return console.warn("Roi for user field faild"),!1}return n}return!1}async function g(n){const t=await(0,a.Yk)(),e=n.clone();t.cvtColor(n,e,t.COLOR_RGBA2GRAY,0),t.threshold(e,e,200,255,t.THRESH_BINARY);const r=new t.MatVector,o=new t.Mat,c=t.Mat.ones(1,10,t.CV_8U),s=t.Mat.ones(3,8,t.CV_8U);t.erode(e,e,c),t.findContours(e,r,o,t.RETR_LIST,t.CHAIN_APPROX_SIMPLE),t.cvtColor(n,e,t.COLOR_RGBA2GRAY,0),t.threshold(e,e,200,255,t.THRESH_BINARY);let l=[],u=0;for(let a=0;a<r.size();++a){const e=t.boundingRect(r.get(a));e.width*e.height<40||(e.height>n.rows/2?u=e.y-5:l.push({mid:e.y+e.height/2,rect:e,type:"",roi:null}))}l=l.filter((n=>n.mid>u)).sort(((n,t)=>n.mid-t.mid));const h=l[l.length-1];l=l.slice(0,6);const f=await m(h,{src:n,dst:e,hierarchy:o,M7:s},r);f&&l.push(f);let d=0;for(const a of l){if(d<2){if(a.type=a.rect.x<n.cols/2?"level":"lock","level"===a.type){const c=e.roi({x:a.rect.x-2,y:a.rect.y-2,width:a.rect.width+4,height:a.rect.height+4});t.findContours(c,r,o,t.RETR_CCOMP,t.CHAIN_APPROX_SIMPLE);let s=9999,l=9999,u=0,h=0;for(let n=0;n<r.size();++n){const e=t.boundingRect(r.get(n));e.width>=c.cols-1||(e.height>=c.rows-1||(s=Math.min(s,e.x),l=Math.min(l,e.y),u=Math.max(u,e.y+e.height),h=Math.max(h,e.x+e.width)))}c.delete(),a.rect=new t.Rect(a.rect.x+s,a.rect.y+l,h-s,u-l);try{a.roi=await(0,i.normalizeToYas)(n.roi(a.rect),!1,{post:n=>{t.threshold(n,n,155,255,t.THRESH_BINARY),t.cvtColor(n,n,t.COLOR_RGBA2GRAY,0)}})}catch(R){throw new Error("Roi for level : "+JSON.stringify(a))}}}else if(!a.type){a.type="sub";const t=3*a.rect.height/4;a.rect.x+=t,a.rect.width-=t;try{a.roi=await(0,i.normalizeToYas)(n.roi(a.rect))}catch(R){a.type=""}}try{a.roi=a.roi||n.roi(a.rect)}catch(R){throw new Error("Roi for "+a.type+": "+JSON.stringify(a))}d++}return e.delete(),r.delete(),o.delete(),c.delete(),s.delete(),{rects:l,splitLine:u}}async function w(n,t){const e=await(0,a.Yk)(),r=n.roi(new e.Rect(0,0,n.cols,t)),o=new e.Mat;e.cvtColor(r,o,e.COLOR_RGBA2GRAY,0),e.threshold(o,o,170,255,e.THRESH_BINARY_INV);const c=e.Mat.ones(1,30,e.CV_8U);e.erode(o,o,c);const s=new e.MatVector,l=new e.Mat;e.findContours(o,s,l,e.RETR_LIST,e.CHAIN_APPROX_SIMPLE);let u=[];for(let a=0;a<s.size();++a){const n=e.boundingRect(s.get(a));n.width<10||n.height<10||(n.width>=r.cols-1||n.x>=r.cols/2||u.push({mid:n.y+n.height/2,rect:n,type:"",roi:null}))}u=u.sort(((n,t)=>n.mid-t.mid)),u=[{...u[0],type:"name"},{...u[2],type:"main"},{...u[3],type:"mainval"}];for(const a of u)a.rect.y=a.rect.y-2,a.rect.height=a.rect.height+4,a.roi=await(0,i.normalizeToYas)(r.roi(a.rect),!0,{pre:"main"===a.type?n=>{e.threshold(n,n,140,255,e.THRESH_BINARY_INV),e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0)}:n=>{e.threshold(n,n,210,255,e.THRESH_BINARY_INV),e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0)},post:"main"===a.type?n=>{e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0),e.threshold(n,n,140,255,e.THRESH_BINARY)}:n=>{e.cvtColor(n,n,e.COLOR_RGBA2GRAY,0),e.threshold(n,n,200,255,e.THRESH_BINARY)}});return r.delete(),o.delete(),s.delete(),l.delete(),c.delete(),u}const A=[{R:189,G:105,B:50},{R:162,G:86,B:225},{R:80,G:128,B:204},{R:41,G:144,B:114},{R:115,G:118,B:141}],C={189:5,162:4,80:3,41:2,115:1};function v(n){const t={R:n[0],G:n[1],B:n[2]},e=(0,s.closest)(t,A);return C[e.R]||0}}}]);
//# sourceMappingURL=3362.c7797072.js.map